(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[459],{3236:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/login",function(){return r(9482)}])},6441:function(e,t,r){"use strict";r.d(t,{Pj:function(){return a}});var n=r(4155);let i={clientId:n.env.NEXT_PUBLIC_AZURE_CLIENT_ID||"",tenantId:n.env.NEXT_PUBLIC_AZURE_TENANT_ID||"common",redirectUri:n.env.NEXT_PUBLIC_AZURE_REDIRECT_URI||"".concat(window.location.origin,"/auth/callback/microsoft"),scopes:["openid","profile","email","User.Read"]},a=new class{async initializeSession(){try{let e=localStorage.getItem("opsgraph_token");if(e){let t=await this.validateToken(e);t?this.setCurrentUser(t):localStorage.removeItem("opsgraph_token")}}catch(e){console.error("Session initialization failed:",e)}}async validateToken(e){try{let t=await fetch("/api/auth/validate",{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(t.ok)return await t.json();return null}catch(e){return console.error("Token validation failed:",e),null}}setCurrentUser(e){this.currentUser=e,this.authStateListeners.forEach(t=>t(e)),e&&this.setSessionContext(e.id)}async setSessionContext(e){try{await fetch("/api/auth/session-context",{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("opsgraph_token")),"Content-Type":"application/json"},body:JSON.stringify({userId:e})})}catch(e){console.error("Failed to set session context:",e)}}async signInWithMicrosoft(){try{let e=this.buildMicrosoftAuthUrl();return window.location.href=e,{user:null,error:null}}catch(e){return{user:null,error:e}}}buildMicrosoftAuthUrl(){let e=new URLSearchParams({client_id:i.clientId,response_type:"code",redirect_uri:i.redirectUri,scope:i.scopes.join(" "),response_mode:"query",state:crypto.randomUUID()});return"https://login.microsoftonline.com/".concat(i.tenantId,"/oauth2/v2.0/authorize?").concat(e)}async handleMicrosoftCallback(e,t){try{let r=await fetch("/api/auth/microsoft/callback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e,state:t})});if(!r.ok)throw Error("Microsoft login failed");let n=await r.json(),i=n.user;return localStorage.setItem("opsgraph_token",n.access_token),this.setCurrentUser(i),{user:i,error:null}}catch(e){return{user:null,error:e}}}async signInWithLocal(e,t){try{let r=await fetch("/api/auth/local/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!r.ok){let e=await r.json();throw Error(e.message||"Login failed")}let n=await r.json(),i=n.user;return localStorage.setItem("opsgraph_token",n.access_token),this.setCurrentUser(i),{user:i,error:null}}catch(e){return{user:null,error:e}}}async createLocalAccount(e){try{let t=await fetch("/api/auth/local/create",{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("opsgraph_token")),"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json();throw Error(e.message||"Account creation failed")}let r=await t.json();return{user:r.user,error:null}}catch(e){return{user:null,error:e}}}async signOut(){try{return await fetch("/api/auth/signout",{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("opsgraph_token")),"Content-Type":"application/json"}}),localStorage.removeItem("opsgraph_token"),this.setCurrentUser(null),{error:null}}catch(e){return localStorage.removeItem("opsgraph_token"),this.setCurrentUser(null),{error:e}}}async getUser(){return this.currentUser}async getProfile(e){var t;return(null===(t=this.currentUser)||void 0===t?void 0:t.profile)||null}async updateProfile(e,t){try{var r;let n=await fetch("/api/users/".concat(e,"/profile"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(localStorage.getItem("opsgraph_token")),"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw Error("Profile update failed");return(null===(r=this.currentUser)||void 0===r?void 0:r.profile)&&(this.currentUser.profile={...this.currentUser.profile,...t},this.setCurrentUser(this.currentUser)),{error:null}}catch(e){return{error:e}}}async getCurrentSession(){try{return{user:this.currentUser,error:null}}catch(e){return{user:null,error:e}}}onAuthStateChange(e){return this.authStateListeners.push(e),()=>{let t=this.authStateListeners.indexOf(e);t>-1&&this.authStateListeners.splice(t,1)}}async canAccessSite(e){var t;let r=null===(t=this.currentUser)||void 0===t?void 0:t.profile;return!!r&&(!!r.is_admin||"admin"===r.role||r.site_ids.includes(e))}async getUserSites(){var e;let t=null===(e=this.currentUser)||void 0===e?void 0:e.profile;return(null==t?void 0:t.site_ids)||[]}async hasAdminAccess(){var e;let t=null===(e=this.currentUser)||void 0===e?void 0:e.profile;return(null==t?void 0:t.is_admin)||(null==t?void 0:t.role)==="admin"||!1}async resetPassword(e){try{let t=await fetch("/api/auth/local/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(!t.ok)throw Error("Password reset failed");return{error:null}}catch(e){return{error:e}}}async changePassword(e,t){try{let r=await fetch("/api/auth/local/change-password",{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("opsgraph_token")),"Content-Type":"application/json"},body:JSON.stringify({currentPassword:e,newPassword:t})});if(!r.ok)throw Error("Password change failed");return{error:null}}catch(e){return{error:e}}}constructor(){this.currentUser=null,this.authStateListeners=[],this.initializeSession()}}},9482:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return U}});var n=r(5893),i=r(7294),a=r(1046),s=r(6254),o=r(8663),l=r(8779),c=r(8186),u=r(8029),d=r(232),h=r(92),p=r(8455),f=r(3636),m=r(8491),g=r(6657),x=r(8843),y=r(4506),j=r(980),w=r(2206),v=r(4296),_=r(9342),b=r(2519),S=r(4831);let k=i.forwardRef(function({title:e,titleId:t,...r},n){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},r),e?i.createElement("title",{id:t},e):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}),I=i.forwardRef(function({title:e,titleId:t,...r},n){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},r),e?i.createElement("title",{id:t},e):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88"}))}),C=i.forwardRef(function({title:e,titleId:t,...r},n){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},r),e?i.createElement("title",{id:t},e):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"}))});var E=r(6441),N=r(1163);let L=e=>{let{onSuccess:t}=e,[r,L]=(0,i.useState)("local"),[U,z]=(0,i.useState)(""),[T,P]=(0,i.useState)(""),[A,O]=(0,i.useState)(!1),[R,M]=(0,i.useState)(!1),[G,B]=(0,i.useState)(null),W=(0,N.useRouter)(),Z=(0,a.ff)("white","gray.800"),q=(0,a.ff)("gray.200","gray.600"),D=async()=>{if(!U||!T){B("Please enter both email and password");return}M(!0),B(null);try{let{user:e,error:r}=await E.Pj.signInWithLocal(U,T);r?B(r.message):e&&(null==t||t(),W.push("/dashboard"))}catch(e){B("Login failed. Please try again.")}finally{M(!1)}},J=async()=>{M(!0),B(null);try{let{error:e}=await E.Pj.signInWithMicrosoft();e&&B(e.message)}catch(e){B("Microsoft login failed. Please try again.")}finally{M(!1)}};return(0,n.jsx)(s.W,{maxW:"md",centerContent:!0,py:20,children:(0,n.jsxs)(o.Z,{w:"full",bg:Z,borderColor:q,borderWidth:"1px",shadow:"xl",children:[(0,n.jsx)(l.O,{textAlign:"center",pb:6,children:(0,n.jsxs)(c.g,{spacing:4,children:[(0,n.jsx)(u.x,{p:4,borderRadius:"full",bg:"brand.100",_dark:{bg:"brand.900"},children:(0,n.jsx)(C,{className:"w-8 h-8 text-brand-500"})}),(0,n.jsxs)(c.g,{spacing:1,children:[(0,n.jsx)(d.X,{size:"lg",color:"brand.500",children:"OpsGraph Login"}),(0,n.jsx)(h.x,{color:"gray.500",fontSize:"sm",children:"Access your operations dashboard"})]})]})}),(0,n.jsx)(p.e,{children:(0,n.jsxs)(c.g,{spacing:6,children:[(0,n.jsxs)(f.U,{spacing:4,w:"full",children:[(0,n.jsx)(m.z,{variant:"local"===r?"solid":"outline",colorScheme:"brand",flex:1,onClick:()=>L("local"),children:"Local Account"}),(0,n.jsx)(m.z,{variant:"microsoft"===r?"solid":"outline",colorScheme:"blue",flex:1,onClick:()=>L("microsoft"),children:"Microsoft Login"})]}),G&&(0,n.jsxs)(g.b,{status:"error",borderRadius:"md",children:[(0,n.jsx)(x.z,{}),G]}),(0,n.jsx)(u.x,{as:"form",onSubmit:e=>{e.preventDefault(),"local"===r?D():J()},w:"full",children:(0,n.jsx)(c.g,{spacing:4,children:"local"===r?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(y.NI,{isRequired:!0,children:[(0,n.jsx)(j.l,{children:"Email"}),(0,n.jsx)(w.I,{type:"email",value:U,onChange:e=>z(e.target.value),placeholder:"Enter your email",disabled:R})]}),(0,n.jsxs)(y.NI,{isRequired:!0,children:[(0,n.jsx)(j.l,{children:"Password"}),(0,n.jsxs)(v.B,{children:[(0,n.jsx)(w.I,{type:A?"text":"password",value:T,onChange:e=>P(e.target.value),placeholder:"Enter your password",disabled:R}),(0,n.jsx)(_.x,{children:(0,n.jsx)(b.h,{"aria-label":A?"Hide password":"Show password",icon:A?(0,n.jsx)(I,{className:"w-4 h-4"}):(0,n.jsx)(k,{className:"w-4 h-4"}),variant:"ghost",size:"sm",onClick:()=>O(!A)})})]})]}),(0,n.jsx)(m.z,{type:"submit",colorScheme:"brand",size:"lg",w:"full",isLoading:R,loadingText:"Signing in...",children:"Sign In"}),(0,n.jsx)(m.z,{variant:"link",size:"sm",onClick:()=>{B("Password reset not yet implemented")},children:"Forgot your password?"})]}):(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(c.g,{spacing:4,w:"full",children:[(0,n.jsx)(h.x,{textAlign:"center",color:"gray.600",children:"Sign in with your Microsoft work account"}),(0,n.jsx)(m.z,{type:"submit",colorScheme:"blue",size:"lg",w:"full",isLoading:R,loadingText:"Redirecting...",leftIcon:(0,n.jsxs)(u.x,{as:"svg",w:5,h:5,viewBox:"0 0 21 21",children:[(0,n.jsx)("path",{fill:"#f25022",d:"M0 0h10v10H0z"}),(0,n.jsx)("path",{fill:"#00a4ef",d:"M11 0h10v10H11z"}),(0,n.jsx)("path",{fill:"#7fba00",d:"M0 11h10v10H0z"}),(0,n.jsx)("path",{fill:"#ffb900",d:"M11 11h10v10H11z"})]}),children:"Sign in with Microsoft"})]})})})}),(0,n.jsx)(S.i,{}),(0,n.jsxs)(h.x,{fontSize:"xs",color:"gray.500",textAlign:"center",children:["OpsGraph Operations Management System",(0,n.jsx)("br",{}),"Site access is controlled by your assigned permissions"]})]})})]})})};var U=()=>(0,n.jsx)(L,{})},8455:function(e,t,r){"use strict";r.d(t,{e:function(){return l}});var n=r(5893),i=r(4926),a=r(9129),s=r(9381),o=r(7430);let l=(0,s.G)(function(e,t){let{className:r,...s}=e,l=(0,a.v)();return(0,n.jsx)(o.m.div,{ref:t,className:(0,i.cx)("chakra-card__body",r),__css:l.body,...s})})},9129:function(e,t,r){"use strict";r.d(t,{Y:function(){return i},v:function(){return a}});var n=r(6140);let[i,a]=(0,n.eC)("Card")},8779:function(e,t,r){"use strict";r.d(t,{O:function(){return l}});var n=r(5893),i=r(4926),a=r(9129),s=r(9381),o=r(7430);let l=(0,s.G)(function(e,t){let{className:r,...s}=e,l=(0,a.v)();return(0,n.jsx)(o.m.div,{ref:t,className:(0,i.cx)("chakra-card__header",r),__css:l.header,...s})})},8663:function(e,t,r){"use strict";r.d(t,{Z:function(){return u}});var n=r(5893),i=r(5544),a=r(4926),s=r(9129),o=r(9381),l=r(9653),c=r(7430);let u=(0,o.G)(function(e,t){let{className:r,children:o,direction:u="column",justify:d,align:h,...p}=(0,i.L)(e),f=(0,l.j)("Card",e);return(0,n.jsx)(c.m.div,{ref:t,className:(0,a.cx)("chakra-card",r),__css:{display:"flex",flexDirection:u,justifyContent:d,alignItems:h,position:"relative",minWidth:0,wordWrap:"break-word",...f.container},...p,children:(0,n.jsx)(s.Y,{value:f,children:o})})})},6254:function(e,t,r){"use strict";r.d(t,{W:function(){return c}});var n=r(5893),i=r(5544),a=r(4926),s=r(9381),o=r(9653),l=r(7430);let c=(0,s.G)(function(e,t){let{className:r,centerContent:s,...c}=(0,i.L)(e),u=(0,o.m)("Container",e);return(0,n.jsx)(l.m.div,{ref:t,className:(0,a.cx)("chakra-container",r),...c,__css:{...u,...s&&{display:"flex",flexDirection:"column",alignItems:"center"}}})});c.displayName="Container"},4831:function(e,t,r){"use strict";r.d(t,{i:function(){return c}});var n=r(5893),i=r(5544),a=r(4926),s=r(9381),o=r(9653),l=r(7430);let c=(0,s.G)(function(e,t){let{borderLeftWidth:r,borderBottomWidth:s,borderTopWidth:c,borderRightWidth:u,borderWidth:d,borderStyle:h,borderColor:p,...f}=(0,o.m)("Divider",e),{className:m,orientation:g="horizontal",__css:x,...y}=(0,i.L)(e);return(0,n.jsx)(l.m.hr,{ref:t,"aria-orientation":g,...y,__css:{...f,border:"0",borderColor:p,borderStyle:h,...{vertical:{borderLeftWidth:r||u||d||"1px",height:"100%"},horizontal:{borderBottomWidth:s||c||d||"1px",width:"100%"}}[g],...x},className:(0,a.cx)("chakra-divider",m)})});c.displayName="Divider"},980:function(e,t,r){"use strict";r.d(t,{l:function(){return u}});var n=r(5893),i=r(5544),a=r(4926),s=r(4506),o=r(9381),l=r(9653),c=r(7430);let u=(0,o.G)(function(e,t){let r=(0,l.m)("FormLabel",e),o=(0,i.L)(e),{className:u,children:h,requiredIndicator:p=(0,n.jsx)(d,{}),optionalIndicator:f=null,...m}=o,g=(0,s.NJ)(),x=g?.getLabelProps(m,t)??{ref:t,...m};return(0,n.jsxs)(c.m.label,{...x,className:(0,a.cx)("chakra-form__label",o.className),__css:{display:"block",textAlign:"start",...r},children:[h,g?.isRequired?p:f]})});u.displayName="FormLabel";let d=(0,o.G)(function(e,t){let r=(0,s.NJ)(),i=(0,s.e)();if(!r?.isRequired)return null;let o=(0,a.cx)("chakra-form__required-indicator",e.className);return(0,n.jsx)(c.m.span,{...r?.getRequiredIndicatorProps(e,t),__css:i.requiredIndicator,className:o})});d.displayName="RequiredIndicator"},9342:function(e,t,r){"use strict";r.d(t,{Z:function(){return u},x:function(){return d}});var n=r(5893),i=r(4926),a=r(4296),s=r(7430),o=r(9381);let l=(0,s.m)("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),c=(0,o.G)(function(e,t){let{placement:r="left",...i}=e,s=(0,a.m)(),o=s.field,c={["left"===r?"insetStart":"insetEnd"]:"0",width:o?.height??o?.h,height:o?.height??o?.h,fontSize:o?.fontSize,...s.element};return(0,n.jsx)(l,{ref:t,__css:c,...i})});c.id="InputElement",c.displayName="InputElement";let u=(0,o.G)(function(e,t){let{className:r,...a}=e,s=(0,i.cx)("chakra-input__left-element",r);return(0,n.jsx)(c,{ref:t,placement:"left",className:s,...a})});u.id="InputLeftElement",u.displayName="InputLeftElement";let d=(0,o.G)(function(e,t){let{className:r,...a}=e,s=(0,i.cx)("chakra-input__right-element",r);return(0,n.jsx)(c,{ref:t,placement:"right",className:s,...a})});d.id="InputRightElement",d.displayName="InputRightElement"},4296:function(e,t,r){"use strict";r.d(t,{B:function(){return m},m:function(){return f}});var n=r(5893),i=r(5544),a=r(2110),s=r(4926),o=r(911),l=r(7155),c=r(7294),u=r(9381),d=r(9653),h=r(7430);let[p,f]=(0,a.k)({name:"InputGroupStylesContext",errorMessage:"useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in \"<InputGroup />\" "}),m=(0,u.G)(function(e,t){let r=(0,d.j)("Input",e),{children:a,className:u,...f}=(0,i.L)(e),m=(0,s.cx)("chakra-input__group",u),g={},x=(0,o.W)(a),y=r.field;x.forEach(e=>{r&&(y&&"InputLeftElement"===e.type.id&&(g.paddingStart=y.height??y.h),y&&"InputRightElement"===e.type.id&&(g.paddingEnd=y.height??y.h),"InputRightAddon"===e.type.id&&(g.borderEndRadius=0),"InputLeftAddon"===e.type.id&&(g.borderStartRadius=0))});let j=x.map(t=>{let r=(0,l.o)({size:t.props?.size||e.size,variant:t.props?.variant||e.variant});return"Input"!==t.type.id?(0,c.cloneElement)(t,r):(0,c.cloneElement)(t,Object.assign(r,g,t.props))});return(0,n.jsx)(h.m.div,{className:m,ref:t,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...r.group},"data-group":!0,...f,children:(0,n.jsx)(p,{value:r,children:j})})});m.displayName="InputGroup"},232:function(e,t,r){"use strict";r.d(t,{X:function(){return c}});var n=r(5893),i=r(5544),a=r(4926),s=r(9381),o=r(9653),l=r(7430);let c=(0,s.G)(function(e,t){let r=(0,o.m)("Heading",e),{className:s,...c}=(0,i.L)(e);return(0,n.jsx)(l.m.h2,{ref:t,className:(0,a.cx)("chakra-heading",e.className),...c,__css:r})});c.displayName="Heading"}},function(e){e.O(0,[237,774,888,179],function(){return e(e.s=3236)}),_N_E=e.O()}]);