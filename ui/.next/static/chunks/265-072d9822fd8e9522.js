"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[265],{3926:function(e,t,r){r.d(t,{QF:function(){return n}});var i=r(5495),s=r(5103);(0,i.O4)("colorMode","system"),(0,i.O4)("sidebarWidth",280);let n=(0,i.O4)("sidebarCollapsed",!1);(0,i.O4)("tablePageSize",10),(0,i.O4)("tableDensity","comfortable"),(0,i.O4)("tableColumns",{tickets:["id","status","priority","summary","assignedTo","createdAt"],alerts:["id","level","code","asset","raisedAt","status"]}),(0,i.O4)("graphLayout","force"),(0,i.O4)("graphZoomLevel",1),(0,i.O4)("graphPhysicsEnabled",!0),(0,s.cn)(null),(0,s.cn)(null),(0,s.cn)([]),(0,i.O4)("dateRange",{start:new Date(Date.now()-6048e5).toISOString(),end:new Date().toISOString()}),(0,i.O4)("ticketFilters",{status:[],priority:[],categories:[],assignedTo:[]}),(0,i.O4)("alertFilters",{level:[],code:[],status:[],assets:[]}),(0,i.O4)("graphFilters",{nodeTypes:[],edgeTypes:[],depth:2}),(0,s.cn)(""),(0,i.O4)("searchHistory",[]),(0,s.cn)([]),(0,i.O4)("notifications",{alerts:!0,tickets:!0,mentions:!0,updates:!0}),(0,i.O4)("userPreferences",{notifications:{desktop:!0,email:!0,sound:!0},dashboard:{defaultView:"tickets",widgets:["openTickets","activeAlerts","recentActivity","teamWorkload"]},accessibility:{reduceMotion:!1,highContrast:!1,largeText:!1}})},1716:function(e,t,r){r.d(t,{aC:function(){return a},c2:function(){return l}});var i=r(5893),s=r(7294);r(6441);var n=r(1163);let o=(0,s.createContext)(void 0),a=()=>{let e=(0,s.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},l=e=>t=>{let{user:r,isLoading:o,hasAdminAccess:l}=a(),[c,h]=(0,s.useState)(!1),[d,u]=(0,s.useState)(!0),p=(0,n.useRouter)();return((0,s.useEffect)(()=>{let e=async()=>{if(r){let e=await l();h(e)}u(!1)};o||e()},[r,o,l]),(0,s.useEffect)(()=>{o||d||r&&c||p.push("/dashboard")},[r,c,o,d,p]),o||d)?(0,i.jsx)("div",{children:"Loading..."}):r&&c?(0,i.jsx)(e,{...t}):null}},3265:function(e,t,r){r.d(t,{h:function(){return D}});var i=r(5893),s=r(5701),n=r(9345),o=r(8329),a=r(2519),l=r(4234),c=r(4614),h=r(9164),d=r(1360),u=r(7391),p=r(10),x=r(3407),g=r(608),f=r(2095),j=r(8029),m=r(1035),y=r(92),w=r(4032),b=r(4302),v=r(7293),S=r(5355),C=r(1716);let k=()=>{let{user:e,signOut:t}=(0,C.aC)();if(!e)return null;let r=e.profile,s=(null==r?void 0:r.full_name)||e.email.split("@")[0],n=(null==r?void 0:r.is_admin)||(null==r?void 0:r.role)==="admin";return(0,i.jsxs)(g.v,{children:[(0,i.jsx)(f.j,{as:j.x,cursor:"pointer",children:(0,i.jsxs)(o.k,{align:"center",gap:2,children:[(0,i.jsx)(m.q,{size:"sm",name:s,src:null==r?void 0:r.avatar_url}),(0,i.jsxs)(j.x,{display:{base:"none",md:"block"},children:[(0,i.jsxs)(o.k,{align:"center",gap:2,children:[(0,i.jsx)(y.x,{fontSize:"sm",fontWeight:"medium",children:s}),n&&(0,i.jsx)(w.C,{colorScheme:"purple",size:"sm",children:"Admin"})]}),(0,i.jsxs)(o.k,{align:"center",gap:2,children:[(0,i.jsx)(y.x,{fontSize:"xs",color:"gray.500",textTransform:"capitalize",children:(null==r?void 0:r.role)||"User"}),(0,i.jsxs)(y.x,{fontSize:"xs",color:"gray.400",children:["(",(null==r?void 0:r.auth_provider)||"local",")"]})]})]})]})}),(0,i.jsxs)(b.q,{children:[(0,i.jsx)(v.s,{children:"Profile"}),(0,i.jsx)(v.s,{children:"Settings"}),(null==r?void 0:r.auth_provider)==="local"&&(0,i.jsx)(v.s,{children:"Change Password"}),(0,i.jsx)(S.R,{}),(0,i.jsx)(v.s,{onClick:()=>t(),children:"Sign out"})]})]})};var _=r(4296),T=r(9342),A=r(2206),O=r(9633);let U=()=>(0,i.jsx)(j.x,{w:{base:"full",md:"400px"},children:(0,i.jsxs)(_.B,{children:[(0,i.jsx)(T.Z,{pointerEvents:"none",children:(0,i.jsx)(O.Z,{width:20,color:"gray"})}),(0,i.jsx)(A.I,{placeholder:"Search tickets, alerts, assets...",bg:"white",border:"1px solid",borderColor:"gray.200",_hover:{borderColor:"gray.300"},_focus:{borderColor:"purple.500",boxShadow:"0 0 0 1px purple.500"}})]})});var I=r(4831),z=r(8186),E=r(4412);let P=()=>(0,i.jsxs)(g.v,{children:[(0,i.jsx)(f.j,{as:a.h,"aria-label":"Notifications",icon:(0,i.jsxs)(j.x,{position:"relative",children:[(0,i.jsx)(E.Z,{width:24}),(0,i.jsx)(w.C,{position:"absolute",top:"-2px",right:"-2px",colorScheme:"red",borderRadius:"full",minW:"20px",h:"20px",fontSize:"xs",display:"flex",alignItems:"center",justifyContent:"center",children:3})]}),variant:"ghost",_hover:{bg:"gray.100"}}),(0,i.jsxs)(b.q,{w:"300px",children:[(0,i.jsx)(j.x,{p:3,children:(0,i.jsx)(y.x,{fontWeight:"bold",mb:2,children:"Notifications"})}),(0,i.jsx)(I.i,{}),(0,i.jsxs)(z.g,{spacing:0,align:"stretch",children:[(0,i.jsx)(v.s,{p:3,children:(0,i.jsxs)(j.x,{children:[(0,i.jsx)(y.x,{fontSize:"sm",fontWeight:"medium",children:"New alert in Building A"}),(0,i.jsx)(y.x,{fontSize:"xs",color:"gray.500",children:"2 minutes ago"})]})}),(0,i.jsx)(v.s,{p:3,children:(0,i.jsxs)(j.x,{children:[(0,i.jsx)(y.x,{fontSize:"sm",fontWeight:"medium",children:"Ticket #1234 assigned to you"}),(0,i.jsx)(y.x,{fontSize:"xs",color:"gray.500",children:"15 minutes ago"})]})}),(0,i.jsx)(v.s,{p:3,children:(0,i.jsxs)(j.x,{children:[(0,i.jsx)(y.x,{fontSize:"sm",fontWeight:"medium",children:"System maintenance scheduled"}),(0,i.jsx)(y.x,{fontSize:"xs",color:"gray.500",children:"1 hour ago"})]})})]}),(0,i.jsx)(I.i,{}),(0,i.jsx)(v.s,{justifyContent:"center",color:"purple.500",children:"View all notifications"})]})]});var Z=r(1046),N=r(1771),L=r(4346),W=r(3771);let R=()=>{let{colorMode:e,toggleColorMode:t}=(0,Z.If)();return(0,i.jsx)(N.u,{label:"Switch to ".concat("light"===e?"dark":"light"," mode"),children:(0,i.jsx)(a.h,{"aria-label":"Toggle theme",icon:"light"===e?(0,i.jsx)(W.Z,{width:20}):(0,i.jsx)(L.Z,{width:20}),onClick:t,variant:"ghost",_hover:{bg:"gray.100"},suppressHydrationWarning:!0})})};var B=r(4818);let D=()=>{let e=(0,s.S)({base:!0,lg:!1}),{isOpen:t,onOpen:r,onClose:g}=(0,n.q)();return(0,i.jsxs)(o.k,{as:"header",align:"center",justify:"space-between",w:"full",px:{base:4,md:6},py:3,bg:"white",borderBottomWidth:"1px",borderColor:"gray.200",boxShadow:"sm",children:[(0,i.jsxs)(o.k,{align:"center",gap:4,children:[e&&(0,i.jsx)(a.h,{"aria-label":"Open menu",icon:(0,i.jsx)(x.Z,{width:24}),onClick:r,variant:"ghost"}),(0,i.jsx)(U,{})]}),(0,i.jsxs)(o.k,{align:"center",gap:4,children:[(0,i.jsx)(R,{}),(0,i.jsx)(P,{}),(0,i.jsx)(k,{})]}),e&&(0,i.jsxs)(l.dy,{isOpen:t,placement:"left",onClose:g,children:[(0,i.jsx)(c.Z,{}),(0,i.jsxs)(h.s,{children:[(0,i.jsx)(d.o,{}),(0,i.jsx)(u.x,{children:"OpsGraph"}),(0,i.jsx)(p.f,{children:(0,i.jsx)(B.T,{})})]})]})]})}},4818:function(e,t,r){r.d(t,{T:function(){return O},Y:function(){return T}});var i=r(5893),s=r(8329),n=r(92),o=r(2519),a=r(4831),l=r(8186),c=r(1771),h=r(8029),d=r(2237),u=r(5413),p=r(6237),x=r(3658),g=r(9856),f=r(5548),j=r(2416),m=r(645),y=r(3045),w=r(8357),b=r(8583),v=r(3926),S=r(1664),C=r.n(S),k=r(1716);let _=[{icon:d.Z,label:"Dashboard",href:"/dashboard"},{icon:u.Z,label:"Tickets",href:"/tickets"},{icon:p.Z,label:"Alerts",href:"/alerts"},{icon:g.Z,label:"Assets",href:"/assets"},{icon:x.Z,label:"Analytics",href:"/analytics"}],T=()=>{var e;let[t,r]=(0,b.KO)(v.QF),{user:c}=(0,k.aC)(),h=(null==c?void 0:null===(e=c.profile)||void 0===e?void 0:e.role)==="admin";return(0,i.jsxs)(s.k,{as:"nav",direction:"column",w:t?"80px":"280px",h:"full",bgGradient:"linear(135deg, purple.900, blue.800)",borderRightWidth:"1px",borderColor:"whiteAlpha.200",position:"fixed",top:0,left:0,zIndex:"docked",transition:"width 0.2s ease-in-out",boxShadow:"xl",children:[(0,i.jsxs)(s.k,{align:"center",justify:t?"center":"space-between",p:4,h:"60px",children:[!t&&(0,i.jsx)(n.x,{fontSize:"xl",fontWeight:"bold",color:"white",letterSpacing:"wider",children:"OpsGraph"}),(0,i.jsx)(o.h,{"aria-label":t?"Expand sidebar":"Collapse sidebar",icon:t?(0,i.jsx)(y.Z,{width:20}):(0,i.jsx)(m.Z,{width:20}),onClick:()=>r(!t),variant:"ghost",color:"whiteAlpha.800",_hover:{bg:"whiteAlpha.200",color:"white"}})]}),(0,i.jsx)(a.i,{borderColor:"whiteAlpha.200"}),(0,i.jsxs)(l.g,{as:"ul",spacing:2,p:2,flex:1,align:"stretch",children:[_.map(e=>{let{icon:r,label:s,href:n}=e;return(0,i.jsx)(A,{icon:(0,i.jsx)(r,{width:24}),label:s,href:n,isCollapsed:t},s)}),h&&(0,i.jsx)(A,{icon:(0,i.jsx)(w.Z,{width:24}),label:"Admin",href:"/admin",isCollapsed:t})]}),(0,i.jsx)(a.i,{borderColor:"whiteAlpha.200"}),(0,i.jsxs)(l.g,{as:"ul",spacing:2,p:2,align:"stretch",children:[(0,i.jsx)(A,{icon:(0,i.jsx)(f.Z,{width:24}),label:"Settings",href:"/settings",isCollapsed:t}),(0,i.jsx)(A,{icon:(0,i.jsx)(j.Z,{width:24}),label:"Logout",href:"/logout",isCollapsed:t})]})]})},A=e=>{let{icon:t,label:r,href:o,isCollapsed:a}=e;return(0,i.jsx)(c.u,{label:a?r:"",placement:"right",children:(0,i.jsx)(h.x,{as:"li",listStyleType:"none",children:(0,i.jsx)(C(),{href:o,style:{textDecoration:"none"},children:(0,i.jsxs)(s.k,{align:"center",p:3,borderRadius:"lg",color:"whiteAlpha.800",cursor:"pointer",_hover:{bg:"whiteAlpha.200",color:"white",transform:"translateX(4px)",transition:"all 0.2s ease"},justify:a?"center":"flex-start",transition:"all 0.2s ease",children:[t,!a&&(0,i.jsx)(n.x,{ml:4,fontWeight:"medium",children:r})]})})})})},O=()=>{var e;let{user:t}=(0,k.aC)(),r=(null==t?void 0:null===(e=t.profile)||void 0===e?void 0:e.role)==="admin";return(0,i.jsxs)(l.g,{as:"ul",spacing:2,p:2,flex:1,align:"stretch",children:[_.map(e=>{let{icon:t,label:r,href:s}=e;return(0,i.jsx)(A,{icon:(0,i.jsx)(t,{width:24}),label:r,href:s,isCollapsed:!1},r)}),r&&(0,i.jsx)(A,{icon:(0,i.jsx)(w.Z,{width:24}),label:"Admin",href:"/admin",isCollapsed:!1})]})}},6441:function(e,t,r){r.d(t,{Pj:function(){return n}});var i=r(4155);let s={clientId:i.env.NEXT_PUBLIC_AZURE_CLIENT_ID||"",tenantId:i.env.NEXT_PUBLIC_AZURE_TENANT_ID||"common",redirectUri:i.env.NEXT_PUBLIC_AZURE_REDIRECT_URI||"".concat(window.location.origin,"/auth/callback/microsoft"),scopes:["openid","profile","email","User.Read"]},n=new class{async initializeSession(){try{let e=localStorage.getItem("opsgraph_token");if(e){let t=await this.validateToken(e);t?this.setCurrentUser(t):localStorage.removeItem("opsgraph_token")}}catch(e){console.error("Session initialization failed:",e)}}async validateToken(e){try{let t=await fetch("/api/auth/validate",{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(t.ok)return await t.json();return null}catch(e){return console.error("Token validation failed:",e),null}}setCurrentUser(e){this.currentUser=e,this.authStateListeners.forEach(t=>t(e)),e&&this.setSessionContext(e.id)}async setSessionContext(e){try{await fetch("/api/auth/session-context",{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("opsgraph_token")),"Content-Type":"application/json"},body:JSON.stringify({userId:e})})}catch(e){console.error("Failed to set session context:",e)}}async signInWithMicrosoft(){try{let e=this.buildMicrosoftAuthUrl();return window.location.href=e,{user:null,error:null}}catch(e){return{user:null,error:e}}}buildMicrosoftAuthUrl(){let e=new URLSearchParams({client_id:s.clientId,response_type:"code",redirect_uri:s.redirectUri,scope:s.scopes.join(" "),response_mode:"query",state:crypto.randomUUID()});return"https://login.microsoftonline.com/".concat(s.tenantId,"/oauth2/v2.0/authorize?").concat(e)}async handleMicrosoftCallback(e,t){try{let r=await fetch("/api/auth/microsoft/callback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e,state:t})});if(!r.ok)throw Error("Microsoft login failed");let i=await r.json(),s=i.user;return localStorage.setItem("opsgraph_token",i.access_token),this.setCurrentUser(s),{user:s,error:null}}catch(e){return{user:null,error:e}}}async signInWithLocal(e,t){try{let r=await fetch("/api/auth/local/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!r.ok){let e=await r.json();throw Error(e.message||"Login failed")}let i=await r.json(),s=i.user;return localStorage.setItem("opsgraph_token",i.access_token),this.setCurrentUser(s),{user:s,error:null}}catch(e){return{user:null,error:e}}}async createLocalAccount(e){try{let t=await fetch("/api/auth/local/create",{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("opsgraph_token")),"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json();throw Error(e.message||"Account creation failed")}let r=await t.json();return{user:r.user,error:null}}catch(e){return{user:null,error:e}}}async signOut(){try{return await fetch("/api/auth/signout",{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("opsgraph_token")),"Content-Type":"application/json"}}),localStorage.removeItem("opsgraph_token"),this.setCurrentUser(null),{error:null}}catch(e){return localStorage.removeItem("opsgraph_token"),this.setCurrentUser(null),{error:e}}}async getUser(){return this.currentUser}async getProfile(e){var t;return(null===(t=this.currentUser)||void 0===t?void 0:t.profile)||null}async updateProfile(e,t){try{var r;let i=await fetch("/api/users/".concat(e,"/profile"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(localStorage.getItem("opsgraph_token")),"Content-Type":"application/json"},body:JSON.stringify(t)});if(!i.ok)throw Error("Profile update failed");return(null===(r=this.currentUser)||void 0===r?void 0:r.profile)&&(this.currentUser.profile={...this.currentUser.profile,...t},this.setCurrentUser(this.currentUser)),{error:null}}catch(e){return{error:e}}}async getCurrentSession(){try{return{user:this.currentUser,error:null}}catch(e){return{user:null,error:e}}}onAuthStateChange(e){return this.authStateListeners.push(e),()=>{let t=this.authStateListeners.indexOf(e);t>-1&&this.authStateListeners.splice(t,1)}}async canAccessSite(e){var t;let r=null===(t=this.currentUser)||void 0===t?void 0:t.profile;return!!r&&(!!r.is_admin||"admin"===r.role||r.site_ids.includes(e))}async getUserSites(){var e;let t=null===(e=this.currentUser)||void 0===e?void 0:e.profile;return(null==t?void 0:t.site_ids)||[]}async hasAdminAccess(){var e;let t=null===(e=this.currentUser)||void 0===e?void 0:e.profile;return(null==t?void 0:t.is_admin)||(null==t?void 0:t.role)==="admin"||!1}async resetPassword(e){try{let t=await fetch("/api/auth/local/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(!t.ok)throw Error("Password reset failed");return{error:null}}catch(e){return{error:e}}}async changePassword(e,t){try{let r=await fetch("/api/auth/local/change-password",{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("opsgraph_token")),"Content-Type":"application/json"},body:JSON.stringify({currentPassword:e,newPassword:t})});if(!r.ok)throw Error("Password change failed");return{error:null}}catch(e){return{error:e}}}constructor(){this.currentUser=null,this.authStateListeners=[],this.initializeSession()}}}}]);